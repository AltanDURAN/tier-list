{% extends 'base.html.twig' %}

{% block body %}
<div class="container w-5/6 mx-auto p-4">

    <h1 class="text-6xl font-bold mb-4 text-center">Qui est le plus beau ?</h1>

    <!-- ========================= -->
    <!-- TIERS      -->
    <!-- ========================= -->
    <div class="tiers">
        {% for tier in ['S', 'A', 'B', 'C', 'D'] %}
        <div class="tier">
            <div class="tier-header"><span class="w-full">Tier {{ tier }}</span></div>

            <div class="tier-items" x-data x-init="
            Sortable.create($el, {
                group: 'tier-items',
                animation: 150,
                onEnd: evt => console.log('Item déplacé dans tier {{ tier }}', evt.item.dataset.itemId)
            });
        ">
                {% for i in 1..3 %}
                <div class="tier-item"
                     data-item-id="{{ tier }}{{ i }}">
                    <span class="w-full">Item {{ tier }}{{ i }}</span>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- ========================= -->
    <!-- NON CLASSÉS           -->
    <!-- ========================= -->
    <div x-data="{ q: '' }">

        <!-- Search bar avec icône et clear -->
        <div class="mt-4 relative w-1/6">
            <input 
                type="text" 
                placeholder="Rechercher un item..."
                class="px-10 py-2 border rounded w-full focus:outline-none focus:ring focus:border-blue-300"
                x-model="q"
            >
            <!-- Icône loupe agrandie -->
            <svg class="w-7 h-7 absolute left-2 -translate-y-1/2 text-gray-400 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="top: 48%;">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-4.35-4.35M5 11a6 6 0 1112 0 6 6 0 01-12 0z"/>
            </svg>

            <!-- Bouton Clear agrandi -->
            <button x-show="q" @click="q=''" class="absolute right-2 -translate-y-1/2 text-gray-500 hover:text-gray-800 text-4xl" style="top: 43%;">&times;</button>

        </div>

        <!-- Liste filtrée -->
        <div id="unassigned-items"
            class="tier-items"
            x-init="Sortable.create($el, { group: 'tiers', animation: 150 })"
            x-effect="
                let visibleCount = 0;
                [...$el.children].forEach(el => {
                    if(el.classList.contains('no-results')) return; // ignorer le message
                    const name = el.innerText.toLowerCase();
                    let qClean = q.toLowerCase().replace(/\s+/g,'');
                    let nameClean = name.replace(/\s+/g,'');
                    let i = 0;
                    let match = true;
                    for(const c of qClean){
                        i = nameClean.indexOf(c, i);
                        if(i === -1){ match = false; break; }
                        i++;
                    }
                    el.style.display = match ? 'flex' : 'none';
                    if(match) visibleCount++;
                });
                $el.querySelector('.no-results').style.display = visibleCount === 0 ? 'flex' : 'none';
            "
        >
            {% for i in 1..10 %}
            <div class="tier-item p-2 border" data-item-id="unassigned{{ i }}">
                <span class="w-full">Non Classé {{ i }}</span>
            </div>
            {% endfor %}

            <!-- Message Aucun résultat -->
            <div class="no-results absolute inset-0 flex items-center justify-center text-gray-400 text-center pointer-events-none text-xl" style="display:none;">
                Aucun résultat
            </div>
        </div>
    </div>
</div>
{% endblock %}
